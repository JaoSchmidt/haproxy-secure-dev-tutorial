version: "3.8"

services:
  haproxy:
    image: haproxy:2.9
    container_name: haproxy
    network_mode: host
    user: root
    cap_add:
      - NET_BIND_SERVICE
    volumes:
      - ./haproxy.cfg:/etc/haproxy/haproxy.cfg:ro # não sei se é no /usr/local/etc/haproxy.cfg, tem q ver dps
      - ./errors:/etc/haproxy/errors:ro
      - ./certs:/certs:ro
    command: ["haproxy", "-f", "/etc/haproxy/haproxy.cfg"]
    restart: unless-stopped

  # certbot:
  #   image: certbot/certbot
  #   container_name: certbot
  #   volumes:
  #     - letsencrypt:/etc/letsencrypt
  #     - certbot-challenges:/var/www/certbot
  #   entrypoint: sh -c "trap exit TERM; while :; do certbot renew --webroot -w /var/www/certbot --quiet && docker kill -s HUP haproxy; sleep 12h; done"
  #   restart: unless-stopped
  #
# volumes:
# certs:
# certbot-challenges:
